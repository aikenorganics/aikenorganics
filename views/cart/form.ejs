<% if (locals.user) { %>
  <form method='POST' class='form-inline' action='/cart' enctype='multipart/form-data'>
    <input type='hidden' name='return_to' value='<%= req.originalUrl %>'>
    <input type='hidden' name='product_id' value='<%= product.id %>'>
    <div class='form-group'>
      <% if (!locals.open) { %>
        <button type='submit' class='btn btn-default' disabled>Market Closed</button>

      <% } else if (!product.available()) { %>
        <button type='submit' class='btn btn-default' disabled>Sold Out</button>

      <% } else if (!product.grower.active) { %>
        <button type='submit' class='btn btn-default' disabled>Unavailable</button>

      <% } else if (cart.quantity(product) > 0) { %>
        <label for='quantity'>In Cart: </label>
        <div class='input-group'>
          <input type='number' id='quantity' name='quantity' min='0' max='<%= product.available() %>' class='form-control' value='<%= cart.quantity(product) %>'>
          <div class='input-group-btn'>
            <button type='submit' class='btn btn-primary'>Update</button>
          </div>
        </div>

      <% } else { %>
        <input type='hidden' name='quantity' value='1'>
        <button type='submit' class='btn btn-primary'>Add to Cart</button>
      <% } %>
    </div>
  </form>
<% } %>
