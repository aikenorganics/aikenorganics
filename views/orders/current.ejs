<main class='container'>

  <% include ../subnav %>

  <% if (locals.open) { %>
    <form method='POST' action='/orders/<%= order.id %>/cancel' enctype='multipart/form-data' class='pull-right'>
      <button type='submit' class='btn btn-danger' data-confirm='Are you sure?'>
        Cancel Order
      </button>
    </form>
  <% } %>
  <h1>Current Order</h1>
  <% if (locals.order) { %>
    <h3>Pickup Location: <%= order.location.name %></h3>
    <table class='table'>
      <thead>
        <tr>
          <th>Name</th>
          <th>Cost</th>
          <th>Quantity</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <% order.productOrders.forEach(function(po) { %>
          <tr>
            <td><a href='/products/<%= po.product.id %>'><%= po.product.name %></a></td>
            <td>$<%= po.cost %></td>
            <td><%= po.quantity %></td>
            <td><%= po.total().toFixed(2) %></td>
          </tr>
        <% }); %>
      </tbody>
      <tfoot>
        <td></td>
        <td></td>
        <td></td>
        <td><strong>$<%= order.total().toFixed(2) %></strong></td>
      </tfoot>
    </table>
    <% if (locals.open) { %>
      <form method='POST' action='/orders/<%= order.id %>' enctype='multipart/form-data'>
        <div class='form-group'>
          <label>Pickup Location</label>
          <select class='form-control' name='location_id'>
            <% locations.forEach(function (location) { %>
              <option value='<%= location.id %>' <% if (location.id === order.location_id) { %>selected<% } %>>
                <%= location.name %>
              </option>
            <% }) %>
          </select>
        </div>
        <div class='text-right'>
          <button type='submit' class='btn btn-primary'>
            Update Order
          </button>
        </div>
      </form>
    <% } %>
  <% } else { %>
    <p class='text-center'>You haven't placed an order yet.</p>
  <% } %>

</main>
